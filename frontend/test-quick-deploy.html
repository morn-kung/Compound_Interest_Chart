<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Deploy Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">‚ö° Quick Deploy Test</h1>
        
        <div class="bg-blue-100 border-l-4 border-blue-500 p-4 mb-6">
            <h2 class="font-semibold">üìç Current GAS URL:</h2>
            <p class="font-mono text-sm mt-1">AKfycbzl0_MJ047GyERwOy3dJ-yEUPFmNIUVwkWdxva6Z0Fttgjj_VI73HqzzJueGjb2V4Bt</p>
            <p class="text-sm text-gray-600 mt-2">‚úÖ URL ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏´‡∏•‡∏±‡∏á Update Deploy</p>
        </div>
        
        <!-- Test Buttons -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <button onclick="testBasic()" class="bg-blue-600 text-white px-4 py-3 rounded hover:bg-blue-700">
                üîß Test Basic
            </button>
            <button onclick="testNewEndpoints()" class="bg-green-600 text-white px-4 py-3 rounded hover:bg-green-700">
                üÜï Test New Endpoints
            </button>
            <button onclick="testPOSTLogin()" class="bg-red-600 text-white px-4 py-3 rounded hover:bg-red-700">
                üîë Test POST Login
            </button>
            <button onclick="clearResults()" class="bg-gray-600 text-white px-4 py-3 rounded hover:bg-gray-700">
                üóëÔ∏è Clear
            </button>
        </div>
        
        <!-- Results -->
        <div class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-lg font-semibold mb-4">üìä Test Results</h2>
            <div id="results" class="space-y-2 max-h-96 overflow-y-auto">
                <p class="text-gray-500">‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏á Update Deploy...</p>
            </div>
        </div>
        
        <!-- Deploy Instructions -->
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 mt-6">
            <h3 class="font-semibold mb-3">üöÄ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£ Update Deploy:</h3>
            <ol class="list-decimal ml-6 space-y-2 text-sm">
                <li>‡πÄ‡∏õ‡∏¥‡∏î <strong>Google Apps Script Editor</strong></li>
                <li>‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏ü‡∏•‡πå <code>DebugLogin.js</code> (copy ‡∏à‡∏≤‡∏Å backend/gg/src/DebugLogin.js)</li>
                <li>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï <code>Code.js</code> ‡∏î‡πâ‡∏ß‡∏¢ debug endpoints ‡πÉ‡∏´‡∏°‡πà</li>
                <li>‡∏Ñ‡∏•‡∏¥‡∏Ñ <strong>"Deploy" ‚Üí "Manage deployments"</strong></li>
                <li>‡∏´‡∏≤ deployment ‡∏ó‡∏µ‡πà‡∏°‡∏µ URL ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏•‡∏¥‡∏Ñ <strong>Edit ‚úèÔ∏è</strong></li>
                <li>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Version ‡πÄ‡∏õ‡πá‡∏ô <strong>"New"</strong> ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏•‡∏¥‡∏Ñ <strong>"Deploy"</strong></li>
                <li>‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</li>
            </ol>
        </div>
    </div>

    <script>
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbzl0_MJ047GyERwOy3dJ-yEUPFmNIUVwkWdxva6Z0Fttgjj_VI73HqzzJueGjb2V4Bt/exec';
        
        function addResult(message, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const div = document.createElement('div');
            
            const colors = {
                info: 'text-blue-600 bg-blue-50 border-blue-200',
                success: 'text-green-600 bg-green-50 border-green-200',
                error: 'text-red-600 bg-red-50 border-red-200',
                warning: 'text-yellow-600 bg-yellow-50 border-yellow-200'
            };
            
            div.className = `p-3 border rounded ${colors[type]} text-sm`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            
            resultsDiv.insertBefore(div, resultsDiv.firstChild);
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '<p class="text-gray-500">Cleared...</p>';
        }
        
        async function testBasic() {
            addResult('üîß Testing basic connection...', 'info');
            
            // Try multiple endpoints to test connection
            const testEndpoints = [
                { name: 'health check', action: 'ping' },
                { name: 'status check', action: 'status' },
                { name: 'getAccounts', action: 'getAccounts' },
                { name: 'getAssets', action: 'getAssets' },
                { name: 'testGetUserData', action: 'testGetUserData' }
            ];
            
            let anySuccess = false;
            
            for (const endpoint of testEndpoints) {
                try {
                    addResult(`üìç Testing ${endpoint.name}...`, 'info');
                    const response = await fetch(`${GAS_URL}?action=${endpoint.action}`);
                    const data = await response.json();
                    
                    if (data.status === 'success' || (data.users && Array.isArray(data.users))) {
                        addResult(`‚úÖ ${endpoint.name} working!`, 'success');
                        if (data.users) {
                            addResult(`üìä Found ${data.users.length} users in database`, 'success');
                        }
                        anySuccess = true;
                        break; // Found working endpoint
                    } else {
                        addResult(`‚ö†Ô∏è ${endpoint.name}: ${data.message || 'Unknown response'}`, 'warning');
                    }
                } catch (error) {
                    addResult(`‚ö†Ô∏è ${endpoint.name} error: ${error.message}`, 'warning');
                }
                
                // Small delay between tests
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            if (anySuccess) {
                addResult('üéâ GAS deployment is working!', 'success');
            } else {
                addResult('‚ùå All basic tests failed - check deployment', 'error');
            }
        }
        
        async function testNewEndpoints() {
            addResult('üÜï Testing new debug endpoints...', 'info');
            
            // Test 1: testLoginWithFullDebug
            try {
                addResult('üìç Testing testLoginWithFullDebug...', 'info');
                const response1 = await fetch(`${GAS_URL}?action=testLoginWithFullDebug&username=4498&password=likit.se4498`);
                const data1 = await response1.json();
                
                if (data1.status === 'success') {
                    addResult('‚úÖ testLoginWithFullDebug working!', 'success');
                } else if (data1.status === 'debug') {
                    addResult('üîç testLoginWithFullDebug debug mode active', 'warning');
                } else {
                    addResult(`‚ùå testLoginWithFullDebug failed: ${data1.message}`, 'error');
                }
            } catch (error) {
                addResult(`üí• testLoginWithFullDebug error: ${error.message}`, 'error');
            }
            
            // Test 2: testDirectAuthentication
            try {
                addResult('üìç Testing testDirectAuthentication...', 'info');
                const response2 = await fetch(`${GAS_URL}?action=testDirectAuthentication&username=4498&password=likit.se4498`);
                const data2 = await response2.json();
                
                if (data2.status === 'success') {
                    addResult('‚úÖ testDirectAuthentication working!', 'success');
                } else {
                    addResult(`‚ùå testDirectAuthentication failed: ${data2.message}`, 'error');
                }
            } catch (error) {
                addResult(`üí• testDirectAuthentication error: ${error.message}`, 'error');
            }
        }
        
        async function testPOSTLogin() {
            addResult('üîë Testing POST login...', 'warning');
            
            try {
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams({
                        action: 'login',
                        username: '4498',
                        password: 'likit.se4498'
                    })
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    addResult('üéâ POST Login WORKING! Problem solved!', 'success');
                    addResult(`üë§ Logged in as: ${data.user?.name}`, 'success');
                } else {
                    addResult(`‚ùå POST Login still failing: ${data.message}`, 'error');
                    if (data.debug) {
                        addResult(`üîç Debug info available - check console`, 'warning');
                        console.log('POST Login Debug:', data.debug);
                    }
                }
            } catch (error) {
                addResult(`üí• POST Login error: ${error.message}`, 'error');
            }
        }
        
        // Auto-test basic connection on load
        document.addEventListener('DOMContentLoaded', () => {
            addResult('‚ö° Quick Deploy Test ready!', 'info');
            addResult('üí° Update deploy ‡πÉ‡∏ô GAS ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏•‡∏¥‡∏Å "Test Basic" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö', 'info');
        });
    </script>
</body>
</html>