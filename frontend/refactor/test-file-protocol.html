<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Test Connection - File Protocol</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 600px;
            text-align: center;
        }
        
        .logo {
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            text-align: left;
        }
        
        .test-section h3 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .button {
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            text-align: left;
            white-space: pre-wrap;
        }
        
        .result.success {
            background: #d4edda;
            border: 2px solid #c3e6cb;
            color: #155724;
        }
        
        .result.error {
            background: #f8d7da;
            border: 2px solid #f5c6cb;
            color: #721c24;
        }
        
        .result.info {
            background: #d1ecf1;
            border: 2px solid #bee5eb;
            color: #0c5460;
        }
        
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .deployment-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-size: 12px;
            color: #666;
        }
        
        .step-indicator {
            display: inline-block;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            line-height: 24px;
            margin-right: 8px;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">üß™</div>
        <h1>Test Connection</h1>
        <p class="subtitle">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ GAS ‡πÅ‡∏ö‡∏ö file:// protocol (‡πÑ‡∏°‡πà‡∏°‡∏µ Mixed Content Issues)</p>
        
        <div class="deployment-info">
            <strong>üìã Current GAS Deployment:</strong><br>
            ID: AKfycbwBVLfsvnVsVTyrc8knKAuMr_ChVFCYsnKCN8CUlpQOOu_HqC5xcnFiFJ1IDv6GqkUY<br>
            Version: V20251003T2233-Refactor-mod (@17)<br>
            Status: ‚úÖ testConnection endpoints ‡πÑ‡∏î‡πâ deploy ‡πÅ‡∏•‡πâ‡∏ß!
        </div>
        
        <!-- Step 1: Basic Connection Test -->
        <div class="test-section">
            <h3><span class="step-indicator">1</span>Basic Connection Test</h3>
            <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á GAS (‡πÉ‡∏ä‡πâ simple GET request ‡∏ó‡∏µ‡πà GAS ‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å)</p>
            <button class="button btn-primary" onclick="testBasicConnection()">
                üåê Test Basic Connection
            </button>
            <div id="basicResult" class="result" style="display: none;"></div>
        </div>
        
        <!-- Step 2: Test testConnection Endpoint -->
        <div class="test-section">
            <h3><span class="step-indicator">2</span>Test Connection Endpoint</h3>
            <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö testConnection endpoint ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà (‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ deploy)</p>
            <button class="button btn-secondary" onclick="testConnectionEndpoint()">
                üîç Test testConnection Endpoint
            </button>
            <div id="testConnectionResult" class="result" style="display: none;"></div>
        </div>
        
        <!-- Step 3: Test Login -->
        <div class="test-section">
            <h3><span class="step-indicator">3</span>Test Login Function</h3>
            <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£ Login (‡πÉ‡∏ä‡πâ POST method)</p>
            <button class="button btn-success" onclick="testLogin()">
                üîê Test Admin Login
            </button>
            <div id="loginResult" class="result" style="display: none;"></div>
        </div>
        
        <!-- Step 4: Clear All Results -->
        <div class="test-section">
            <h3><span class="step-indicator">üóëÔ∏è</span>Clear Results</h3>
            <p>‡∏•‡πâ‡∏≤‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
            <button class="button btn-danger" onclick="clearAllResults()">
                üóëÔ∏è Clear All Results
            </button>
        </div>
        
        <div class="deployment-info" style="margin-top: 30px;">
            <strong>üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong><br>
            1. ‡∏ñ‡πâ‡∏≤ Step 1 ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à = GAS connection ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô<br>
            2. ‡∏ñ‡πâ‡∏≤ Step 2 ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß = ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ push testConnection endpoints<br>
            3. ‡∏ñ‡πâ‡∏≤ Step 3 ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à = ‡∏£‡∏∞‡∏ö‡∏ö Login ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥<br>
            4. ‡πÉ‡∏ä‡πâ file:// protocol = ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Mixed Content
        </div>
    </div>

    <script>
        // üîß Configuration
        const CONFIG = {
            gasUrl: 'https://script.google.com/macros/s/AKfycbw9KitTE_kS-4JUn_uydhT0ffLJdUHqHVSKKsiACO8IR9WNYuctLrAUaROY_8JvzDq1/exec',
            timeout: 15000
        };
        
        // üõ†Ô∏è Utility Functions
        function showResult(elementId, data, type = 'info') {
            const resultDiv = document.getElementById(elementId);
            resultDiv.style.display = 'block';
            resultDiv.className = `result ${type}`;
            
            if (typeof data === 'object') {
                resultDiv.textContent = JSON.stringify(data, null, 2);
            } else {
                resultDiv.textContent = data;
            }
        }
        
        function showLoading(elementId, message = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö...') {
            const resultDiv = document.getElementById(elementId);
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.innerHTML = `<span class="loading"></span>${message}`;
        }
        
        // üì° Test Functions
        
        // Step 1: Basic Connection Test
        async function testBasicConnection() {
            showLoading('basicResult', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö Basic Connection...');
            
            try {
                // ‡πÉ‡∏ä‡πâ simple GET request ‡πÑ‡∏õ‡∏¢‡∏±‡∏á GAS (‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ action = ‡∏à‡∏∞‡πÑ‡∏î‡πâ default response)
                const response = await fetch(CONFIG.gasUrl, {
                    method: 'GET',
                    signal: AbortSignal.timeout(CONFIG.timeout)
                });
                
                const data = await response.text(); // ‡πÉ‡∏ä‡πâ text() ‡∏Å‡πà‡∏≠‡∏ô
                
                const result = {
                    timestamp: new Date().toISOString(),
                    test: 'Basic Connection Test',
                    status: response.ok ? '‚úÖ SUCCESS' : '‚ùå FAILED',
                    response_status: response.status,
                    response_ok: response.ok,
                    response_data: data,
                    note: response.ok ? 'GAS ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ' : 'GAS ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ'
                };
                
                showResult('basicResult', result, response.ok ? 'success' : 'error');
                
            } catch (error) {
                const errorResult = {
                    timestamp: new Date().toISOString(),
                    test: 'Basic Connection Test',
                    status: '‚ùå ERROR',
                    error_type: error.name,
                    error_message: error.message,
                    possible_causes: [
                        '‡πÑ‡∏°‡πà‡∏°‡∏µ Internet connection',
                        'GAS URL ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
                        'GAS Web App ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ Deploy',
                        'Firewall blocking'
                    ]
                };
                
                showResult('basicResult', errorResult, 'error');
            }
        }
        
        // Step 2: Test testConnection Endpoint
        async function testConnectionEndpoint() {
            showLoading('testConnectionResult', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö testConnection endpoint...');
            
            try {
                // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö GET method ‡∏Å‡∏±‡∏ö testConnection action
                const response = await fetch(CONFIG.gasUrl + '?action=testConnection', {
                    method: 'GET',
                    signal: AbortSignal.timeout(CONFIG.timeout)
                });
                
                const data = await response.json();
                
                const result = {
                    timestamp: new Date().toISOString(),
                    test: 'testConnection Endpoint Test',
                    method: 'GET',
                    status: response.ok && data.status === 'success' ? '‚úÖ SUCCESS' : '‚ùå FAILED',
                    response_status: response.status,
                    gas_response: data,
                    note: response.ok && data.status === 'success' ? 
                          'testConnection endpoint ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß!' : 
                          'testConnection endpoint ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ deploy ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤'
                };
                
                showResult('testConnectionResult', result, 
                          response.ok && data.status === 'success' ? 'success' : 'error');
                
            } catch (error) {
                const errorResult = {
                    timestamp: new Date().toISOString(),
                    test: 'testConnection Endpoint Test',
                    status: '‚ùå ERROR',
                    error_type: error.name,
                    error_message: error.message,
                    conclusion: 'testConnection endpoint ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ push ‡πÑ‡∏õ GAS ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ CORS',
                    next_action: '‡∏ï‡πâ‡∏≠‡∏á clasp push ‡∏Å‡πà‡∏≠‡∏ô'
                };
                
                showResult('testConnectionResult', errorResult, 'error');
            }
        }
        
        // Step 3: Test Login
        async function testLogin() {
            showLoading('loginResult', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö Login...');
            
            try {
                const formData = new FormData();
                formData.append('action', 'login');
                formData.append('username', '4498');
                formData.append('password', 'likit.se4498');
                
                const response = await fetch(CONFIG.gasUrl, {
                    method: 'POST',
                    body: formData,
                    signal: AbortSignal.timeout(CONFIG.timeout)
                });
                
                const data = await response.json();
                
                const result = {
                    timestamp: new Date().toISOString(),
                    test: 'Login Test',
                    method: 'POST',
                    username: '4498',
                    status: response.ok && data.status === 'success' ? '‚úÖ LOGIN SUCCESS' : '‚ùå LOGIN FAILED',
                    response_status: response.status,
                    login_response: data,
                    note: response.ok && data.status === 'success' ? 
                          'Login ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥!' : 
                          'Login ‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö username/password ‡∏´‡∏£‡∏∑‡∏≠ GAS code'
                };
                
                showResult('loginResult', result, 
                          response.ok && data.status === 'success' ? 'success' : 'error');
                
            } catch (error) {
                const errorResult = {
                    timestamp: new Date().toISOString(),
                    test: 'Login Test',
                    status: '‚ùå ERROR',
                    error_type: error.name,
                    error_message: error.message,
                    possible_causes: [
                        'GAS connection ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ',
                        'Login service ‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤',
                        'Database/Sheet ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ'
                    ]
                };
                
                showResult('loginResult', errorResult, 'error');
            }
        }
        
        // Clear All Results
        function clearAllResults() {
            const resultDivs = ['basicResult', 'testConnectionResult', 'loginResult'];
            resultDivs.forEach(id => {
                const div = document.getElementById(id);
                div.style.display = 'none';
                div.textContent = '';
            });
        }
        
        // üöÄ Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üß™ Test Connection - File Protocol Ready');
            console.log('üì¶ GAS URL:', CONFIG.gasUrl);
            console.log('‚ö†Ô∏è  Note: testConnection endpoints may not be deployed yet');
        });
    </script>
</body>
</html>